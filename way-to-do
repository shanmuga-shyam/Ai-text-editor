' üß© 1Ô∏è‚É£ What You‚Äôre Building

' A Word AI Assistant that:

' Reads your document.

' Sends the text to your own Google Apps Script endpoint.

' That script calls Gemini 2.5 Flash-Lite (or other available Gemini models).

' Gemini analyses your text and sends structured feedback back into Word.

' ‚öôÔ∏è 2Ô∏è‚É£ Fixing the Early Errors
' Error	Root Cause	Fix
' Access is denied (VBA)	Word not allowed to run macros or use HTTP	Enabled macros and trusted location
' AI endpoint returned HTML	Script not publicly deployed	Deploy script as Web app ‚Üí Anyone can access
' Script function not found: doGet	You opened the link in browser (GET)	You must use POST, handled by VBA
' 404 model not found	Wrong Gemini model name	Use models/gemini-2.5-flash-lite
' Bad control character in JSON	Raw text contained quotes/newlines	Encode text in Base64 before sending
' 500 internal error	Broken JSON or permissions	Fixed by Base64 + proper error handling
' üß† 3Ô∏è‚É£ Final Google Apps Script

' üìç Create a new project in Google Apps Script
' ,
' paste this code (replace only the key placeholder),
' then deploy as a Web App ‚Üí
' Execute as: Me‚ÄÉAccess: Anyone (anonymous).

' // ==============================
' // Gemini AI Endpoint for Word
' // ==============================
' const GEMINI_KEY = 'YOUR_API_KEY_HERE'; // <-- keep private

' function doPost(e) {
'   try {
'     const data = JSON.parse(e.postData.contents);
'     const promptEncoded = data.prompt || "";
'     const prompt = Utilities.newBlob(
'       Utilities.base64Decode(promptEncoded)
'     ).getDataAsString();

'     const model = "models/gemini-2.5-flash-lite";

'     const payload = {
'       contents: [{ parts: [{ text: prompt }] }]
'     };

'     const response = UrlFetchApp.fetch(
'       `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${GEMINI_KEY}`,
'       {
'         method: "post",
'         contentType: "application/json",
'         muteHttpExceptions: true,
'         payload: JSON.stringify(payload)
'       }
'     );

'     const result = JSON.parse(response.getContentText());
'     const text = result?.candidates?.[0]?.content?.parts?.[0]?.text
'                   || "No result from Gemini.";
'     return ContentService.createTextOutput(text);

'   } catch (err) {
'     return ContentService.createTextOutput("Error: " + err.message);
'   }
' }


' ‚úÖ After saving ‚Üí Deploy > New deployment > Web app ‚Üí copy the URL ending in /exec.

' üíª 4Ô∏è‚É£ Final VBA Code for Word

' üìç Open Word ‚Üí Alt + F11 ‚Üí Insert > Module ‚Üí paste this:

' ' ======================================
' ' AI Research Assistant for Microsoft Word
' ' Communicates with Google Apps Script
' ' Safe Base64 implementation
' ' ======================================

' Sub RunAI_Assistant()
'     On Error GoTo ErrorHandler
'     Dim http As Object
'     Dim apiUrl As String, structureUrl As String
'     Dim docText As String, structure As String
'     Dim prompt As String, encodedPrompt As String
'     Dim jsonBody As String, aiFeedback As String

'     ' ---- YOUR LINKS ----
'     structureUrl = "https://raw.githubusercontent.com/shanmuga-shyam/ai-word/refs/heads/main/ai-word.json"
'     apiUrl = "PASTE_YOUR_WEB_APP_URL_HERE"

'     Set http = CreateObject("MSXML2.ServerXMLHTTP.6.0")

'     ' ---- LOAD STRUCTURE ----
'     http.Open "GET", structureUrl, False
'     http.Send
'     If http.Status <> 200 Then
'         MsgBox "Couldn't load structure file. Code: " & http.Status, vbCritical
'         Exit Sub
'     End If
'     structure = http.responseText

'     ' ---- READ DOCUMENT ----
'     docText = ActiveDocument.Content.Text

'     ' ---- BUILD PROMPT ----
'     prompt = "You are an academic reviewer AI. Compare the following document against this structure:" & _
'              vbCrLf & structure & vbCrLf & "Document:" & vbCrLf & docText

'     ' ---- ENCODE AND SEND ----
'     encodedPrompt = EncodeBase64(StrConv(prompt, vbFromUnicode))
'     jsonBody = "{""prompt"":""" & encodedPrompt & """}"

'     http.Open "POST", apiUrl, False
'     http.setRequestHeader "Content-Type", "application/json"
'     http.Send jsonBody

'     ' ---- DISPLAY RESULT ----
'     If http.Status = 200 Then
'         aiFeedback = http.responseText
'         ActiveDocument.Content.InsertBefore "?? AI Feedback:" & vbCrLf & aiFeedback & vbCrLf & String(40, "-") & vbCrLf
'         MsgBox "‚úÖ AI feedback added to document.", vbInformation
'     Else
'         MsgBox "‚ùå Server Error " & http.Status & vbCrLf & http.responseText, vbCritical
'     End If

' Cleanup:
'     Set http = Nothing
'     Exit Sub

' ErrorHandler:
'     MsgBox "Error contacting AI service: " & Err.Description, vbCritical
'     Resume Cleanup
' End Sub

' ' ---- BASE64 ENCODER ----
' Private Function EncodeBase64(text As String) As String
'     Dim bytes() As Byte, objXML As Object, objNode As Object
'     bytes = StrConv(text, vbFromUnicode)
'     Set objXML = CreateObject("MSXML2.DOMDocument")
'     Set objNode = objXML.createElement("b64")
'     objNode.DataType = "bin.base64"
'     objNode.nodeTypedValue = bytes
'     EncodeBase64 = Replace(objNode.Text, vbLf, "")
' End Function

' üîí 5Ô∏è‚É£ Trust Settings in Word

' File ‚Üí Options ‚Üí Trust Center ‚Üí Trusted Locations ‚Üí add the folder where your .docm file lives.

' Macro Settings ‚Üí Enable all macros + trust VBA object model.

' Save file as .docm (macro-enabled).

' üìÑ 6Ô∏è‚É£ What to Write in Word (Test Content)

' Paste this and save:

' Renewable Energy and Its Global Impact

' Renewable energy is essential for reducing greenhouse gas emissions and ensuring sustainable development. As fossil fuel resources decline, renewable energy sources such as solar, wind, and hydro are becoming increasingly important. However, adoption in developing countries has been slow due to high costs and limited technical expertise.

' Governments and policymakers must collaborate to accelerate renewable energy transitions. Investments in education, training, and infrastructure will be key to overcoming barriers.


' Then run RunAI_Assistant (or reopen the doc if you connected it to Document_Open).

' ‚úÖ 7Ô∏è‚É£ Expected Output

' At the top of the document:

' ?? AI Feedback:
' Your document is missing Abstract and Methodology sections.
' Consider adding data or results to strengthen analysis.
' ----------------------------------------

' üß∞ 8Ô∏è‚É£ Optional Improvements

' Auto-highlight missing section titles.

' Batch-review multiple Word files.

' Replace gemini-2.5-flash-lite with gemini-flash-latest when available.

' Host the structure JSON in your own Drive or GitHub repo.

' üéØ End Result

' You now have a fully working offline+online hybrid AI reviewer inside Microsoft Word ‚Äî
' ‚úÖ secure (no key shown),
' ‚úÖ fast (Gemini 2.5 Flash-Lite),
' ‚úÖ stable (Base64 fixed every JSON error).



' these and all for offline word document
' https://chatgpt.com/share/69122f49-54dc-8008-acb3-61d9121cae04